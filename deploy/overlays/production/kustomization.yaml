apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base
  - ../../base/cnpg-operator
  - ../../base/cnpg-storage
  - ../../base/cnpg-cluster
  - ../../base/cnpg-pooler
  - ../../base/cnpg-backup
  - ../../base/cnpg-monitoring
  - persistent-volumes-production.yaml
  - ingress-production.yaml
  - network-policy.yaml

images:
  - name: naytife/backend
    newName: ghcr.io/<OWNER>/<REPO>/backend
    newTag: ci-seed
  - name: naytife/auth-handler
    newName: ghcr.io/<OWNER>/<REPO>/auth-handler
    newTag: ci-seed
  - name: template-registry
    newName: ghcr.io/<OWNER>/<REPO>/template-registry
    newTag: ci-seed
  - name: docker.io/library/store-deployer
    newName: ghcr.io/<OWNER>/<REPO>/store-deployer
    newTag: ci-seed

replicas:
  - name: backend
    count: 3
  - name: store-deployer
    count: 3
  - name: postgres
    count: 1
  - name: redis
    count: 1

labels:
  - pairs:
      environment: production
      deployment-method: kustomize

patches:
  - path: backend-production-patch.yaml
  - path: auth-handler-production-patch.yaml
  - path: postgres-production-patch.yaml
  - path: redis-production-patch.yaml
  - path: template-registry-production-patch.yaml
  - path: store-deployer-production-patch.yaml
  - path: cnpg-cluster-production-patch.yaml

namePrefix: prod-

configMapGenerator:
  - name: production-config
    literals:
      - LOG_LEVEL=warn
      - APP_ENV=production
      - DATABASE_HOST=postgres.naytife-production.svc.cluster.local
      - REDIS_HOST=redis.naytife-production.svc.cluster.local
