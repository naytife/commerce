image:
  repository: oryd/oathkeeper
  tag: v0.40.7
oathkeeper:
  config:
    log:
      leak_sensitive_values: true
    access_rules:
      matching_strategy: glob
      repositories:
        - file:///etc/rules/access-rules.json

    errors:
      fallback:
        - json

      handlers:
        json:
          enabled: true
          config:
            verbose: true
        redirect:
          enabled: true
          config:
            to: http://example-idp.local/login # Hydra's login page
            when:
              - error:
                  - unauthorized
                  - forbidden
                request:
                  header:
                    accept:
                      - text/html

    authenticators:
      anonymous:
        enabled: true
        config:
          subject: guest

      noop:
        enabled: true

      oauth2_introspection:
        enabled: true
        config:
          introspection_url: http://hydra-admin.naytife-ory.svc.cluster.local:4445/oauth2/introspect
          scope_strategy: exact
          required_scope:
            - hydra.openid
            - offline
          trusted_issuers:
            - http://127.0.0.1:8080
          pre_authorization:
            enabled: true
            client_id: 761506cc-511f-411c-bf31-752efd8063b3
            client_secret: z.WE65SP5o0oXDYJwLdyoqYUuN
            scope:
              - introspect
            token_url: http://hydra-public.naytife-ory.svc.cluster.local:4444/oauth2/token
          token_from:
            header: Authorization
          retry:
            max_delay: 300ms
            give_up_after: 2s
          cache:
            enabled: true
            ttl: 60s
      oauth2_client_credentials:
        enabled: true
        config:
          token_url: http://hydra-public.naytife-ory:4444/oauth2/token
      jwt:
        enabled: true
        config:
          jwks_urls:
            - http://hydra-public.naytife-ory:4444/.well-known/jwks.json # This URL exposes Hydra's keys for verifying JWTs
          allowed_algorithms:
            - RS256
          trusted_issuers:
            - http://hydra-public.naytife-ory:4444

    authorizers:
      allow:
        enabled: true
      keto_engine_acp_ory:
        enabled: true
        config:
          base_url: http://keto-read.naytife-ory.svccluster.local:4466
          required_action: "my:action:$1"
          required_resource: "my:resource:$2:foo:$1"
          subject: "{{ .Extra.email }}"
          flavor: exact

    mutators:
      noop:
        enabled: true
      header:
        enabled: true
        config:
          headers:
            X-User-Id: "{{ print .Subject }}"
            X-User-Email: "{{ print .Extra.email }}"
